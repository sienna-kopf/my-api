# my-api
## Overview:
Tasked with building out ReST, single-finders, multi-finders, and buisness intelligence endpoints for a simple e-commerce site.
- Ruby on Rails API
- Responses serialized adherent to JSON 1.0 industry standards
- Test Driven Development with ~100% coverage in RSpec Test Suite
- Focus on MVC design principals and ReST

## Learning Goals: 
- Expose an API
- Use serializers to format JSON responses
- Test API exposure
- Compose advanced ActiveRecord queries to analyze information stored in SQL databasese
- Write basic SQL statements without the assistance of an ORM

## Getting Started 
### Pre Built Front End test suite [Rails Driver](https://github.com/turingschool-examples/rails_driver) 
- `git clone git@github.com:turingschool-examples/rails_driver.git` 
- `cd rails_driver`
- `bundle` (if this fails, try to `bundle update` and then retry)
- `rails db:create` && `rails db:migrate`
- `bundle exec figaro install`
- In `config/application.yml` add `RAILS_ENGINE_DOMAIN: http://localhost:3000` to set up the server port. 

###  `my_api` Back End Ruby on Rails API
From the same root level as `rails_driver`:
- `git clone git@github.com:sienna-kopf/my-api.git`
- `cd my_api`
- `bundle install`

## Testing: 
The `my_api` application is fully tested using RSpec reporting ~100% test coverage determined by SimpleCov. 
To run the test suite, setup the application and run `bundle exec rspec` in the terminal. To run a specific test run `bundle exec rspec <test file path>`. To open the coverage report generated by SimpleCov run `open coverage/index.html`.

To run the front-end Test Suite, [Rails Driver](https://github.com/turingschool-examples/rails_driver), setup that applicaition and run `bundle exec rspec` in the terminal. There should be 16 passing tests and one failing test for a buisness intelligence endpoint. 

## Endpoint Use:
[Postman](https://www.postman.com/downloads/) is recommended, but any API platform that allows you to run enpoint queries with query params, headers, and a request body will do! </br>

In `my_api` run `rails s` to start the server. This will give you a port URL, something like `http://localhost:3000`, which is the main URI path for all the endpoint queries. In your API platform, the base URL will look like `http://localhost:3000/api/v1/<endpoint>` because all current endpoints are part of the first version of the API, and are therefore namespaced as such. </br>

### Example 1: 
#### Item ReST (index action (no body))

To run the `items` index endpoint, the URL in your API platform would look like `http://localhost:3000/api/v1/items` with the request method type set to `GET`.

In Postman, the setup for this endpoint looks like:
![Screen Shot 2020-10-12 at 10 39 33 PM](https://user-images.githubusercontent.com/62857073/95816258-df615080-0cdb-11eb-90af-5e4b9b1e2c6c.png)

The response for this endpoint is a JSON 1.0 standard display of all of the items seeded into the database, including name, description, unit_price, and merchant_id for each item. A sample of this response looks like:
![Screen Shot 2020-10-12 at 10 41 30 PM](https://user-images.githubusercontent.com/62857073/95816337-16cffd00-0cdc-11eb-89c4-7b5bc00e428a.png)

#### Item ReST (create action (with body)) 
To run the `items` create endpoint, the URL in your API platform would look like `http://localhost:3000/api/v1/items` with the request method type set to `POST`. For this endpoint, we also need to send a request body with the new items name, description, unit_price, and merchant_id. In Postman, we will include this information as JSON under the body tab like this:
![Screen Shot 2020-10-12 at 10 43 24 PM](https://user-images.githubusercontent.com/62857073/95816514-86de8300-0cdc-11eb-84ab-0aefce271060.png)

The response for this endpoint is a JSON 1.0 standard display of the details for the item that was just created, including name, description, unit_price, and merchant_id for each item. For this example the response looks like:
![Screen Shot 2020-10-12 at 10 44 22 PM](https://user-images.githubusercontent.com/62857073/95816516-88a84680-0cdc-11eb-97bd-63b8b59f5e70.png)

#### Merchant Relationships (merchant-items)

To run the `merchant/:id/items` merchant-items endpoint, the URL in your API platform would look like `http://localhost:3000/api/v1/merchant/:id/items` with the request method type set to `GET`. The path variable `:id` should be set to an existant merchant id in the database. In Postman, the setup for this endpoint looks like:
![Screen Shot 2020-10-12 at 10 58 41 PM](https://user-images.githubusercontent.com/62857073/95817370-7cbd8400-0cde-11eb-8ec7-0004d3947dab.png)

The response for this endpoint is a JSON 1.0 standard display of all of the items seeded into the database with that merchant as an associated foreign key, including name, description, unit_price, and merchant_id for each item. A sample of this response looks like:
![Screen Shot 2020-10-12 at 10 59 47 PM](https://user-images.githubusercontent.com/62857073/95817421-a4145100-0cde-11eb-91f1-5cc421e6e095.png)

#### Merchant ReST (delete action (with dependencies)
To run the `merchants` delete endpoint, the URL in your API platform would look like `http://localhost:3000/api/v1/merchants/:id` with the request method type set to `DELETE`. The path variable `:id` must be set to an existant merchant in the database. In Postman, this setup looks like: 
![Screen Shot 2020-10-12 at 10 48 26 PM](https://user-images.githubusercontent.com/62857073/95816784-23088a00-0cdd-11eb-9d3a-195d1822adb0.png)

The response for this endpoint sends a 204 HTTP status code:
![Screen Shot 2020-10-12 at 10 49 34 PM](https://user-images.githubusercontent.com/62857073/95816819-36b3f080-0cdd-11eb-9e9a-2637cadec55c.png)

The deletion of a `merchant` from the database triggers a series of dependecy deletes for any `invoices`, `invoiceItems`, `payments`, and `items` associated in a dependent fashion to that `merchant`. 

This can be demonstrated by establishing that a `merchant` has many items through the `merchants/:id/items` endpoint. This might look like: 
![Screen Shot 2020-10-12 at 10 53 39 PM](https://user-images.githubusercontent.com/62857073/95817192-205a6480-0cde-11eb-9a55-42e13aa05e5f.png)

Then, when that merchant is deleted, a search for any of the items displayed under the merchant items endpoint display a 204 no content error. The same is true for other associated objects such as `invoices`, `payments`, and `invoiceItems`:
![Screen Shot 2020-10-12 at 10 55 15 PM](https://user-images.githubusercontent.com/62857073/95817195-20f2fb00-0cde-11eb-83d9-4288cb0d2ea5.png)


